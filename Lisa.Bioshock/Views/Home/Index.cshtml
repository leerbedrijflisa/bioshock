@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";   
}
<script src="~/Scripts/GuiController.js"></script>
<script type="text/javascript">
    $(function () {

        var hub = $.connection.customHub;
        //var lastKeyDown = undefined;

        var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
            value: "",
            lineNumbers: true,
            mode: "htmlmixed",
            theme: "default",
            gutters: ["CodeMirror-linenumbers"]
        });

        //function editorKeyDown(event) {

        //    lastKeyDown = event.keyCode;
        //}

        //function editorKeyUp(event) {

        //    if (event.keyCode == 17 && lastKeyDown == 17) {

        //        $('#editorTab').toggle();
        //        editor.focus();
        //    }
        //}

        //$(window).keydown(editorKeyDown);
        //$(window).keyup(editorKeyUp);
        
        //var iframe = document.getElementById('preview');
        //$(iframe.contentDocument).keydown(editorKeyDown);
        //$(iframe.contentDocument).keyup(editorKeyUp);
        
        //$("#editorTab").draggable({ ifraneFix: true, cancel: '#editor', handle: '#toolbar' }).resizable();

        

        hub.client.addMessage = function (codeMessage) {
            
            var title = codeMessage.match(/<title>(.+)<\//im);            

            if (title) {

                document.title = title[1];
            }
            
            $('#preview').contents().find('html').html(codeMessage);
        };

        $.connection.hub.start().done(function () {
            hub.server.send($('#editor').val());

            editor.on('change', function (codeMirror) {
                
                hub.server.send(codeMirror.getValue());
            });
        });

    });
</script>

<iframe id="preview" frameborder="0"></iframe>
<div id="overlay"></div>
<div id="editorTab">
    <div id="toolbar"></div>
    <div id="editorContainer">
        <textarea id="editor"></textarea>
    </div>
    
</div>

<script type="text/javascript">
    var guiController = new GuiController('#editorTab', '#toolbar', '#editorContainer', '#overlay');
</script>